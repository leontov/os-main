## Быстрая инструкция для AI-кодинг-агента

Этот репозиторий — Kolibri OS: гибрид C/Python/JS проекта с wasm-ядром. Ниже — конкретные правила и ссылки на файлы, которые помогут быстро стать продуктивным.

- Политика и приоритеты: см. `AGENTS.md` — блок ```kolibri-policy``` определяет ответы на вопросы о том, чей код править (fields `prefer_ours` / `prefer_theirs`) и бюджетные ограничения (например, `wasm_max_kb`). Скрипт `scripts/policy_validate.py` проверяет наличие и формат блока.

- Структура проекта (критично):
  - `backend/` — серверная часть, C/Python взаимодействие, приоритет для «ours» по умолчанию.
  - `frontend/` — веб-интерфейс; собирается отдельно и ожидает предварительно собранный wasm в `build/wasm/kolibri.wasm`.
  - `kernel/`, `apps/`, `kolibri_os/` — C-код ядра и сборки образов/iso; уважайте CMake/C toolchain.
  - `core/` — основной Python-симулятор и библиотека (`kolibri_sim.py`, `representations.py`).

- Команды сборки и тестирования (копировать в терминал):
  - C-стек: `cmake -S . -B build -G "Ninja" && cmake --build build`
  - Сборка wasm: `./scripts/build_wasm.sh` (нужно перед билдом фронтенда)
  - Фронтенд: `cd frontend && npm install && npm run build`
  - Тесты/линтеры: `pytest -q`, `ruff check .`, `pyright`, `ctest --test-dir build`

- Про стиль и соглашения:
  - Python: проект использует `ruff` + `pyright` (см. `requirements.txt`). Следуйте существующей структуре файлов в `apps/` и `tests/`.
  - C/C++: используйте стандарты, принятые в коде (`CMakeLists.txt`, `kernel/`), минимизируйте форматирование, меняйте только то, что необходимо.
  - Frontend: типичный Node.js + Vite/TS конфиг в `frontend/`.

- Интеграционные точки и паттерны:
  - wasm binary: `build/wasm/kolibri.wasm` — создаётся скриптами/сборкой; фронтенд ожидает именно этот артефакт.
  - Данные и конфиg: `data/` содержит сериализованные таблицы/файлы (например `knp_theta.json`) — изменения тут влияют поведению симулятора.
  - Трассировка/ленты: `kolibri_trace.jsonl`, `core/tracing.py` используются для отладки симуляций.

- Примеры конкретных локейшенов при изменениях:
  - Изменять Python-API симулятора: `core/kolibri_sim.py`, `core/representations.py`.
  - Менять формат или экспорт wasm: `scripts/build_wasm.sh`, `kernel/` и `build/wasm/`.
  - Обновлять CI-политики или приоритеты слияний: редактировать `AGENTS.md` и проверять `scripts/policy_validate.py`.

- Что избегать / особенности:
  - Не переставляйте глобально политики из `AGENTS.md` — они валидируются и влияют на релизные шаги (см. `docs/release_process.md`).
  - Не меняйте большие бинарные артефакты (>1MB) без согласования; `AGENTS.md` указывает ограничения на wasm.

- Если нужно предложить изменения архитектуры — выдавайте чёткий план: файлы для правки, тесты для запуска и возможные регрессии (wasm size, сборка фронтенда, API обратной совместимости).

Если что-то осталось непонятным, скажите, какая часть — и я дополню инструкцию примером патча и команд для проверки.
