# KolibriScript — язык мысли цифрового организма

## Назначение
KolibriScript служит естественным русскоязычным интерфейсом к цифровому ядру Kolibri. Каждое предложение сценария описывает намерение оператора: обучение, создание формулы, проверку гипотезы, управление роем. Интерпретатор преобразует текст в потоки десятичных импульсов, соблюдая Закон Единства, и передаёт их в эволюционное ядро.

## Базовые конструкции

### Блок `начало … конец`
Сценарий всегда начинается с директивы `начало:` и завершается `конец.`. Все команды внутри блока выполняются последовательно, если не указано иное управляющей конструкцией.

```text
начало:
    показать "приветствие"
конец.
```

### Объявление переменных
Команда `переменная` создаёт именованный контейнер для цифровой последовательности.

```text
переменная память = "фрактал"
```

Интерпретатор транслирует строковые литералы в десятичный поток через `kolibri_transducirovat_utf8`, сохраняя обратимость.

### Команда `показать`
Выполняет потоковую декодировку и выводит значение переменной или литерала.

```text
показать "Kolibri готов к обучению"
```

### Обучение ассоциации
Оператор `обучить связь` создаёт новую связку стимул→ответ. Интерпретатор помещает оба аргумента в цифровой журнал и вызывает `kolibri_pool_obuchit_svjaz`.

```text
обучить связь "привет" -> "здравствуй"
```

### Создание формулы
Команда `создать формулу` принимает имя и выражение на внутреннем десятичном DSL.

```text
создать формулу сумма из "a + b"
```

Имя используется для ссылок в последующих командах. Выражение транслируется в поток цифр и передаётся движку мутаций.

### Оценка формулы
Инструкция `оценить` сопоставляет формулу с задачей.

```text
оценить сумма на задаче "2+2"
```

Результат помещается в переменную `итог`, доступную для проверок.

### Условная конструкция
`если … тогда … иначе … конец` управляет выполнением веток. Условие сравнивается с десятичным порогом.

```text
если фитнес сумма > 0.8 тогда
    сохранить сумма в геном
иначе
    отбросить сумма
конец
```

### Цикл `пока`
Позволяет повторять блок, пока условие истинно.

```text
пока поколение < 10 делать
    вызвать эволюцию
конец
```

## Системные команды

| Команда | Назначение |
| --- | --- |
| `вызвать эволюцию` | Запускает один цикл `teach/ask/tick/evolve` для текущего пула формул. |
| `сохранить <формула> в геном` | Добавляет блок `GENE_STORE` в `genome.dat` с HMAC. |
| `отбросить <формула>` | Удаляет временную формулу из пула без записи. |
| `распечатать канву` | Просит ядро вернуть фрактальную канву памяти для визуализации. |
| `рой отправить <формула>` | Отправляет формулу соседям по протоколу KSP. |

## Цифровой формат `.ksd`

1.  Заголовок: сигнатура `707` (три цифры) для валидации.
2.  Таблица символов: каждая лексема кодируется уникальным идентификатором (например, `обучить` → `101`, `формула` → `203`).
3.  Поле длины: количество цифр полезной нагрузки.
4.  Полезная нагрузка: последовательность токенов в постфиксной записи.
5.  Контрольная подпись: 32 цифры HMAC-SHA256.

Такая структура позволяет интерпретатору быстро проверять целостность сценария и воспроизводить его выполнение.

## Обработка ошибок
Все ошибки интерпретатор фиксирует в цифровом геноме с типом `SCRIPT_ERROR`.

| Код | Описание |
| --- | --- |
| `1` | Неизвестная команда или идентификатор. |
| `2` | Несогласованность блоков `если/конец`. |
| `3` | Переполнение памяти при трансдукции. |

## Минимальный пример

```text
начало:
    показать "Kolibri приветствует Первого Архитектора"
    обучить связь "привет" -> "здравствуй"
    создать формулу f из "a + b"
    оценить f на задаче "2+2"
    если фитнес f > 0.8 тогда
        сохранить f в геном
    иначе
        отбросить f
    конец
конец.
```

## Дальнейшее развитие
- Расширение синтаксиса циклами `для` и обработчиками роевых событий.
- Интеграция с визуальной корой: пошаговая визуализация выполнения скрипта.
- Автоматическое порождение `ksd` из русскоязычных описаний через KolibriScript-компилятор.
